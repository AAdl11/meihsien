<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>A* å°‹è·¯éŠæˆ² | Journey of Kindness</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }

    #app {
      max-width: 1400px;
      margin: 0 auto;
    }

    .header {
      text-align: center;
      color: white;
      margin-bottom: 30px;
    }

    .header h1 {
      font-size: 2.5em;
      margin-bottom: 10px;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }

    .demo-button {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 15px 40px;
      border-radius: 30px;
      font-size: 1.1em;
      cursor: pointer;
      margin: 20px auto;
      display: block;
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
      transition: transform 0.2s;
    }

    .demo-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0,0,0,0.3);
    }

    .game-container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-bottom: 20px;
    }

    .panel {
      background: rgba(255, 255, 255, 0.95);
      border-radius: 20px;
      padding: 30px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.1);
    }

    .panel h2 {
      color: #667eea;
      margin-bottom: 20px;
      font-size: 1.8em;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .instructions {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 10px;
      margin-bottom: 20px;
    }

    .instructions ol {
      margin-left: 20px;
      line-height: 1.8;
    }

    .instructions li {
      margin-bottom: 8px;
    }

    .highlight {
      color: #e74c3c;
      font-weight: bold;
    }

    .grid-container {
      display: inline-block;
      border: 3px solid #667eea;
      border-radius: 10px;
      overflow: hidden;
      background: white;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }

    .grid-row {
      display: flex;
    }

    .grid-cell {
      width: 60px;
      height: 60px;
      border: 1px solid #ddd;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s;
      position: relative;
      background-size: cover;
      background-position: center;
    }

    .grid-cell:hover {
      transform: scale(1.05);
      z-index: 10;
    }

    .grid-cell.obstacle {
      background-color: #34495e;
      cursor: not-allowed;
    }

    .grid-cell.start {
      background-color: #2ecc71;
      color: white;
      font-weight: bold;
    }

    .grid-cell.goal {
      background-color: #e74c3c;
      color: white;
      font-weight: bold;
    }

    .grid-cell.user-path {
      background-color: #f39c12;
    }

    .grid-cell.ai-path {
      background-color: #3498db;
    }

    .step-number {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: #000;
      font-weight: bold;
      font-size: 24px;
      text-shadow: 0 0 3px white, 0 0 5px white;
      z-index: 10;
      pointer-events: none;
    }
    
    .cell-icon {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 32px;
      z-index: 5;
      pointer-events: none;
    }

    .controls {
      display: flex;
      flex-direction: column;
      gap: 15px;
      margin-top: 20px;
    }

    .button {
      padding: 15px 30px;
      border: none;
      border-radius: 10px;
      font-size: 1.1em;
      cursor: pointer;
      transition: all 0.3s;
      font-weight: bold;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }

    .button:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    }

    .button-reset {
      background: linear-gradient(135deg, #f39c12 0%, #f1c40f 100%);
      color: white;
    }

    .button-compare {
      background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
      color: white;
    }

    .button-compare:disabled {
      background: #95a5a6;
      cursor: not-allowed;
    }

    .button-next {
      background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);
      color: white;
    }

    .stats {
      background: #f8f9fa;
      padding: 20px;
      border-radius: 10px;
      margin-top: 20px;
    }

    .stats h3 {
      color: #667eea;
      margin-bottom: 15px;
    }

    .stat-item {
      display: flex;
      justify-content: space-between;
      padding: 10px 0;
      border-bottom: 1px solid #ddd;
    }

    .stat-item:last-child {
      border-bottom: none;
    }

    .stat-value {
      font-weight: bold;
      color: #2c3e50;
    }

    .results {
      margin-top: 20px;
    }

    .result-header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 15px;
    }

    .result-header h3 {
      color: #667eea;
      font-size: 1.5em;
    }

    .checkmark {
      color: #2ecc71;
      font-size: 1.5em;
    }

    .comparison {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 30px;
      border-radius: 15px;
      text-align: center;
      margin-top: 20px;
    }

    .efficiency {
      font-size: 3em;
      font-weight: bold;
      margin: 20px 0;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }

    .trophy {
      font-size: 2em;
      margin-bottom: 10px;
    }

    .path-log {
      background: #2c3e50;
      color: #2ecc71;
      padding: 15px;
      border-radius: 10px;
      font-family: 'Courier New', monospace;
      max-height: 300px;
      overflow-y: auto;
      margin-top: 15px;
    }

    .path-log p {
      margin: 5px 0;
    }

    .back-button {
      position: fixed;
      bottom: 30px;
      left: 50%;
      transform: translateX(-50%);
      background: linear-gradient(135deg, #e91e63 0%, #f06292 100%);
      color: white;
      border: none;
      padding: 15px 40px;
      border-radius: 30px;
      font-size: 1.1em;
      cursor: pointer;
      box-shadow: 0 4px 15px rgba(0,0,0,0.3);
      transition: all 0.3s;
      z-index: 1000;
    }

    .back-button:hover {
      transform: translateX(-50%) translateY(-3px);
      box-shadow: 0 6px 20px rgba(0,0,0,0.4);
    }

    .celebration {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 2000;
      animation: fadeIn 0.3s;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .celebration-content {
      background: white;
      padding: 50px;
      border-radius: 20px;
      text-align: center;
      animation: bounceIn 0.5s;
    }

    @keyframes bounceIn {
      0% { transform: scale(0.3); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }

    .celebration-content h2 {
      color: #2ecc71;
      font-size: 3em;
      margin-bottom: 20px;
    }

    .celebration-emoji {
      font-size: 5em;
      margin-bottom: 20px;
    }

    .hidden {
      display: none;
    }

    @media (max-width: 1200px) {
      .game-container {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div id="app">
    <div class="header">
      <h1>ğŸ—ºï¸ æ…ˆæ‚²ä¹‹æ—… Journey of Kindness</h1>
      <button class="demo-button" onclick="game.showAIDemo()">
        ğŸ¤– å…ˆçœ‹AIæ¼”ç¤º Watch AI Demo First
      </button>
    </div>

    <div class="game-container">
      <!-- Left Panel: Your Path -->
      <div class="panel">
        <h2>âœ¨ ä½ çš„è·¯å¾‘ Your Path</h2>
        
        <div class="instructions">
          <strong>éŠæˆ²èªªæ˜:</strong>
          <ol>
            <li>é» ğŸ¤– <strong>å…ˆçœ‹AIæ¼”ç¤º</strong> | Watch AI demo first</li>
            <li>å¾<span class="highlight">ç¶ è‰²æ…ˆæ¿Ÿæœƒæ‰€</span>åˆ°<span class="highlight">ç´…è‰²é£Ÿç‰©ä¸­å¿ƒ</span></li>
            <li><span class="highlight">åªèƒ½ä¸Šä¸‹å·¦å³!</span></li>
          </ol>
        </div>

        <div class="grid-container" id="userGrid"></div>

        <div class="controls">
          <button class="button button-reset" onclick="game.resetGame()">
            ğŸ”„ é‡æ–°é–‹å§‹ Reset
          </button>
          <button class="button button-compare" id="compareBtn" onclick="game.compareWithAI()" disabled>
            âœ… æäº¤ & æ¯”è¼ƒAI Submit & Compare AI
          </button>
          <button class="button button-next" onclick="game.goToNext()">
            â¡ï¸ ç¹¼çºŒ
          </button>
        </div>

        <div class="stats hidden" id="userStats">
          <h3>ä½ çš„çµ±è¨ˆ:</h3>
          <div class="stat-item">
            <span>è·¯å¾‘é•·åº¦:</span>
            <span class="stat-value" id="userPathLength">0 æ­¥</span>
          </div>
          <div class="stat-item">
            <span>ç•¶å‰:</span>
            <span class="stat-value" id="currentPos">(0, 0)</span>
          </div>
        </div>
      </div>

      <!-- Right Panel: AI Solution -->
      <div class="panel">
        <h2>ğŸ¤– AI æœ€å„ªè§£</h2>
        
        <div class="results hidden" id="aiResults">
          <div class="result-header">
            <span class="checkmark">âœ…</span>
            <h3>A* Complete!</h3>
          </div>
          <div class="stat-item">
            <span>è·¯å¾‘:</span>
            <span class="stat-value" id="aiPathLength">0 æ­¥</span>
          </div>
          <div class="stat-item">
            <span>æ¢ç´¢:</span>
            <span class="stat-value" id="aiExploredNodes">0 ç¯€é»</span>
          </div>
        </div>

        <div class="comparison hidden" id="comparisonPanel">
          <h3>ğŸ“Š Human vs AI</h3>
          <div class="efficiency" id="efficiencyScore">0%</div>
          <div class="trophy hidden" id="perfectTrophy">ğŸ† PERFECT!</div>
          <div class="path-log" id="pathLog"></div>
        </div>
      </div>
    </div>

    <button class="back-button" onclick="game.goBack()">
      â† è¿”å›ä¸»é¸å–®
    </button>

    <!-- Celebration Modal -->
    <div class="celebration hidden" id="celebration" onclick="game.hideCelebration()">
      <div class="celebration-content">
        <div class="celebration-emoji">ğŸ‰ğŸŠğŸ‰</div>
        <h2>YOU REACHED GOAL!</h2>
        <p style="font-size: 1.5em; color: #667eea;">å¤ªæ£’äº†ï¼é»æ“Šæ¯”è¼ƒAI!</p>
      </div>
    </div>
  </div>

  <script>
    // Pure JavaScript implementation - No Vue needed!
    const game = {
      gridSize: 8,
      start: { row: 0, col: 0 },
      goal: { row: 7, col: 7 },
      obstacles: [
        { row: 1, col: 1 }, { row: 2, col: 1 }, { row: 3, col: 1 },
        { row: 4, col: 1 }, { row: 5, col: 1 }, { row: 6, col: 1 }
      ],
      userPath: [],
      currentPos: { row: 0, col: 0 },
      aiPath: [],
      aiExploredNodes: 0,
      userReachedGoal: false,

      init() {
        this.userPath = [{ ...this.start }];
        this.renderGrid();
        this.stopBackgroundMusic();
      },

      stopBackgroundMusic() {
        if (window.opener && window.opener.stopBackgroundMusic) {
          window.opener.stopBackgroundMusic();
        }
        try {
          if (window.opener) {
            const parentAudios = window.opener.document.querySelectorAll('audio');
            parentAudios.forEach(audio => {
              audio.pause();
              audio.currentTime = 0;
            });
          }
        } catch (e) {
          console.log('Could not access parent window audio');
        }
      },

      renderGrid() {
        const gridContainer = document.getElementById('userGrid');
        gridContainer.innerHTML = '';

        for (let row = 0; row < this.gridSize; row++) {
          const rowDiv = document.createElement('div');
          rowDiv.className = 'grid-row';

          for (let col = 0; col < this.gridSize; col++) {
            const cell = document.createElement('div');
            cell.className = 'grid-cell';
            cell.onclick = () => this.handleCellClick(row, col);

            // Add cell classes
            const cellClass = this.getCellClass(row, col);
            if (cellClass) cell.classList.add(cellClass);

            // Add icons
            if (this.isStart(row, col)) {
              const icon = document.createElement('span');
              icon.className = 'cell-icon';
              icon.textContent = 'ğŸššğŸ’™';
              cell.appendChild(icon);
            }

            if (this.isGoal(row, col)) {
              const icon = document.createElement('span');
              icon.className = 'cell-icon';
              icon.textContent = 'ğŸªğŸ';
              cell.appendChild(icon);
            }

            // Add step numbers
            const stepNum = this.getStepNumber(row, col);
            if (stepNum) {
              const numSpan = document.createElement('span');
              numSpan.className = 'step-number';
              numSpan.textContent = stepNum;
              cell.appendChild(numSpan);
            }

            rowDiv.appendChild(cell);
          }

          gridContainer.appendChild(rowDiv);
        }
      },

      isObstacle(row, col) {
        return this.obstacles.some(obs => obs.row === row && obs.col === col);
      },

      isStart(row, col) {
        return row === this.start.row && col === this.start.col;
      },

      isGoal(row, col) {
        return row === this.goal.row && col === this.goal.col;
      },

      isInUserPath(row, col) {
        return this.userPath.some(pos => pos.row === row && pos.col === col);
      },

      isInAIPath(row, col) {
        return this.aiPath.some(pos => pos.row === row && pos.col === col);
      },

      getCellClass(row, col) {
        if (this.isObstacle(row, col)) return 'obstacle';
        if (this.isStart(row, col)) return 'start';
        if (this.isGoal(row, col)) return 'goal';
        if (this.isInUserPath(row, col)) return 'user-path';
        if (this.isInAIPath(row, col)) return 'ai-path';
        return '';
      },

      getStepNumber(row, col) {
        const userIndex = this.userPath.findIndex(pos => pos.row === row && pos.col === col);
        if (userIndex !== -1) return userIndex + 1;
        
        const aiIndex = this.aiPath.findIndex(pos => pos.row === row && pos.col === col);
        if (aiIndex !== -1) return aiIndex + 1;
        
        return null;
      },

      handleCellClick(row, col) {
        if (this.userReachedGoal) return;
        
        if (this.isObstacle(row, col)) {
          alert('ä¸èƒ½èµ°åˆ°éšœç¤™ç‰©ï¼Cannot walk through obstacles!');
          return;
        }

        const rowDiff = Math.abs(row - this.currentPos.row);
        const colDiff = Math.abs(col - this.currentPos.col);
        
        if ((rowDiff === 1 && colDiff === 0) || (rowDiff === 0 && colDiff === 1)) {
          this.userPath.push({ row, col });
          this.currentPos = { row, col };
          this.renderGrid();
          this.updateStats();
          
          if (this.isGoal(row, col)) {
            this.userReachedGoal = true;
            document.getElementById('compareBtn').disabled = false;
            document.getElementById('celebration').classList.remove('hidden');
          }
        } else {
          alert('åªèƒ½ä¸Šä¸‹å·¦å³ç§»å‹•ä¸€æ ¼ï¼Only move up/down/left/right one cell!');
        }
      },

      updateStats() {
        document.getElementById('userStats').classList.remove('hidden');
        document.getElementById('userPathLength').textContent = `${this.userPath.length} æ­¥`;
        document.getElementById('currentPos').textContent = `(${this.currentPos.row}, ${this.currentPos.col})`;
      },

      showAIDemo() {
        this.runAStar();
        document.getElementById('aiResults').classList.remove('hidden');
        document.getElementById('aiPathLength').textContent = `${this.aiPath.length} æ­¥`;
        document.getElementById('aiExploredNodes').textContent = `${this.aiExploredNodes} ç¯€é»`;
        this.renderGrid();
      },

      runAStar() {
        const openSet = [{ ...this.start, g: 0, h: this.heuristic(this.start), f: this.heuristic(this.start), parent: null }];
        const closedSet = [];
        let exploredCount = 0;

        while (openSet.length > 0) {
          openSet.sort((a, b) => a.f - b.f);
          const current = openSet.shift();
          exploredCount++;

          if (current.row === this.goal.row && current.col === this.goal.col) {
            this.aiPath = this.reconstructPath(current);
            this.aiExploredNodes = exploredCount;
            return;
          }

          closedSet.push(current);
          const neighbors = this.getNeighbors(current);

          for (const neighbor of neighbors) {
            if (closedSet.some(node => node.row === neighbor.row && node.col === neighbor.col)) continue;
            
            const tentativeG = current.g + 1;
            const existingNode = openSet.find(node => node.row === neighbor.row && node.col === neighbor.col);

            if (!existingNode || tentativeG < existingNode.g) {
              const newNode = {
                ...neighbor,
                g: tentativeG,
                h: this.heuristic(neighbor),
                f: tentativeG + this.heuristic(neighbor),
                parent: current
              };

              if (existingNode) {
                Object.assign(existingNode, newNode);
              } else {
                openSet.push(newNode);
              }
            }
          }
        }
      },

      heuristic(pos) {
        return Math.abs(pos.row - this.goal.row) + Math.abs(pos.col - this.goal.col);
      },

      getNeighbors(pos) {
        const neighbors = [];
        const directions = [
          { row: -1, col: 0 }, { row: 1, col: 0 },
          { row: 0, col: -1 }, { row: 0, col: 1 }
        ];

        for (const dir of directions) {
          const newRow = pos.row + dir.row;
          const newCol = pos.col + dir.col;

          if (newRow >= 0 && newRow < this.gridSize && 
              newCol >= 0 && newCol < this.gridSize && 
              !this.isObstacle(newRow, newCol)) {
            neighbors.push({ row: newRow, col: newCol });
          }
        }

        return neighbors;
      },

      reconstructPath(node) {
        const path = [];
        let current = node;
        
        while (current) {
          path.unshift({ row: current.row, col: current.col });
          current = current.parent;
        }
        
        return path;
      },

      compareWithAI() {
        if (!this.userReachedGoal) {
          alert('è«‹å…ˆåˆ°é”ç›®æ¨™ï¼Please reach the goal first!');
          return;
        }

        document.getElementById('comparisonPanel').classList.remove('hidden');
        
        const efficiency = Math.round((this.aiPath.length / this.userPath.length) * 100);
        document.getElementById('efficiencyScore').textContent = `æ•ˆç‡: ${efficiency}%`;
        
        if (efficiency === 100) {
          document.getElementById('perfectTrophy').classList.remove('hidden');
        }

        const logHtml = [
          ...this.aiPath.map((pos, i) => `AI: (${pos.row}, ${pos.col})`),
          `ğŸ AI: ${this.aiPath.length} steps | 100%`,
          `ğŸ¯ YOUR TURN! Try to beat AI!`,
          ...this.userPath.map((pos, i) => `You: (${pos.row}, ${pos.col})`),
          `You: ${this.userPath.length} | AI: ${this.aiPath.length} | ${efficiency}%`
        ].map(text => `<p>${text}</p>`).join('');

        document.getElementById('pathLog').innerHTML = logHtml;
      },

      resetGame() {
        this.userPath = [{ ...this.start }];
        this.currentPos = { row: 0, col: 0 };
        this.userReachedGoal = false;
        document.getElementById('compareBtn').disabled = true;
        document.getElementById('comparisonPanel').classList.add('hidden');
        document.getElementById('celebration').classList.add('hidden');
        document.getElementById('perfectTrophy').classList.add('hidden');
        this.renderGrid();
        this.updateStats();
      },

      hideCelebration() {
        document.getElementById('celebration').classList.add('hidden');
      },

      goToNext() {
        alert('ä¸‹ä¸€å€‹ç®—æ³•coming soon! Next algorithm coming soon!');
      },

      goBack() {
        window.location.href = 'index.html';
      }
    };

    // Initialize game when page loads
    window.addEventListener('DOMContentLoaded', () => game.init());
  </script>
</body>
</html>
