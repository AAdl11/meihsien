<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A* Search - Journey of Kindness</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/pyodide/v0.23.4/full/pyodide.js"></script>
    <style>
        .grid-cell {
            width: 50px;
            height: 50px;
            border: 1px solid #ccc;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 12px;
        }
        .grid-cell:hover:not(.cell-start):not(.cell-goal) {
            background: #e0f2fe;
            transform: scale(1.05);
        }
        .cell-start {
            background: #22c55e !important;
            color: white;
            font-weight: bold;
        }
        .cell-goal {
            background: #ef4444 !important;
            color: white;
            font-weight: bold;
        }
        .cell-human-path {
            background: #fbbf24 !important;
            color: #000;
            font-weight: bold;
        }
        .cell-ai-path {
            background: #3b82f6 !important;
            color: white;
            font-weight: bold;
        }
        .cell-both-path {
            background: linear-gradient(135deg, #fbbf24 50%, #3b82f6 50%) !important;
            color: white;
            font-weight: bold;
        }
        @keyframes celebrate {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.3) rotate(10deg); }
        }
        .celebrating {
            animation: celebrate 0.5s ease-in-out;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .ai-demo-cell {
            animation: pulse 0.8s ease-in-out;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-purple-900 to-blue-900 min-h-screen text-white">
    
    <!-- Audio Elements -->
    <audio id="clickSound" preload="auto">
        <source src="data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBSuBzvLZiTYIGGS57OahUhELTKXh8bllHgU2jdXuy3UpBSh+zPDajzsKFV+16+qnVRQLRp/g8r5sIQUrgc7y2Yk2CBhkuezmoVIRC0yl4fG5ZR4FNo3V7st1KQUofszw2o87ChVftevqp1UUC0af4PK+bCEFK4HO8tmJNggYZLns5qFSEQtMpeHxuWUeBTaN1e7LdSkFKH7M8NqPOwoVX7Xr6qdVFAtGn+DyvmwhBSuBzvLZiTYIGGS57OahUhELTKXh8bllHgU2jdXuy3UpBSh+zPDajzsKFV+16+qnVRQLRp/g8r5sIQUrgc7y2Yk2CBhkuezmoVIRC0yl4fG5ZR4FNo3V7st1KQUofszw2o87ChVftevqp1UUC0af4PK+bCEFK4HO8tmJNggYZLns5qFSEQtMpeHxuWUeBTaN1e7LdSkFKH7M8NqPOwoVX7Xr6qdVFAtGn+DyvmwhBSuBzvLZiTYIGGS57OahUhELTKXh8bllHgU2jdXuy3UpBSh+zPDajzsKFV+16+qnVRQLRp/g8r5sIQUrgc7y2Yk2CBhkuezmoVIRC0yl4fG5ZR4FNo3V7st1KQUofszw2o87ChVftevqp1UUC0af4PK+bCEFK4HO8tmJNggYZLns5qFSEQtMpeHxuWUeBTaN1e7LdSkFKH7M8NqPOwoVX7Xr6qdVFAtGn+DyvmwhBSuBzvLZiTYIGGS57OahUhELTKXh8bllHgU2jdXuy3UpBSh+zPDajzsKFV+16+qnVRQLRp/g8r5sIQU=" type="audio/wav">
    </audio>
    <audio id="successSound" preload="auto">
        <source src="data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBSuBzvLZiTYIGGS57OahUhELTKXh8bllHgU2jdXuy3UpBSh+zPDajzsKFV+16+qnVRQLRp/g8r5sIQUrgc7y2Yk2CBhkuezmoVIRC0yl4fG5ZR4FNo3V7st1KQUofszw2o87ChVftevqp1UUC0af4PK+bCEFK4HO8tmJNggYZLns5qFSEQtMpeHxuWUeBTaN1e7LdSkFKH7M8NqPOwoVX7Xr6qdVFAtGn+DyvmwhBSuBzvLZiTYIGGS57OahUhELTKXh8bllHgU2jdXuy3UpBSh+zPDajzsKFV+16+qnVRQLRp/g8r5sIQUrgc7y2Yk2CBhkuezmoVIRC0yl4fG5ZR4FNo3V7st1KQUofszw2o87ChVftevqp1UUC0af4PK+bCEFK4HO8tmJNggYZLns5qFSEQtMpeHxuWUeBTaN1e7LdSkFKH7M8NqPOwoVX7Xr6qdVFAtGn+DyvmwhBSuBzvLZiTYIGGS57OahUhELTKXh8bllHgU2jdXuy3UpBSh+zPDajzsKFV+16+qnVRQLRp/g8r5sIQUrgc7y2Yk2CBhkuezmoVIRC0yl4fG5ZR4FNo3V7st1KQUofszw2o87ChVftevqp1UUC0af4PK+bCEFK4HO8tmJNggYZLns5qFSEQtMpeHxuWUeBTaN1e7LdSkFKH7M8NqPOwoVX7Xr6qdVFAtGn+DyvmwhBSuBzvLZiTYIGGS57OahUhELTKXh8bllHgU2jdXuy3UpBSh+zPDajzsKFV+16+qnVRQLRp/g8r5sIQU=" type="audio/wav">
    </audio>
    
    <div class="container mx-auto px-4 py-8">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold mb-2">ğŸ—ºï¸ A* Search Algorithm</h1>
            <p class="text-xl">é£Ÿç‰©é…é€è·¯å¾‘å„ªåŒ– | Food Delivery Route Optimization</p>
            <p class="text-lg mt-2">
                <span class="font-bold">æ•…äº‹ Story:</span> 
                å¹«åŠ©Sister Roxanneæ‰¾åˆ°å¾æ…ˆæ¿Ÿæœƒæ‰€åˆ°çµäººè§’çš„æœ€çŸ­è·¯å¾‘<br>
                Help Sister Roxanne find the shortest path from Tzu Chi office to Hunters Point
            </p>
        </div>

        <!-- AI Demo Button -->
        <div class="text-center mb-6">
            <button id="ai-demo-btn" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-8 rounded-full transition text-lg">
                ğŸ¤– å…ˆçœ‹AIæ¼”ç¤º Watch AI Demo First
            </button>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            
            <!-- Left: Game Board -->
            <div class="bg-white/10 p-6 rounded-lg backdrop-blur">
                <h2 class="text-2xl font-bold mb-4">
                    ğŸ® ä½ çš„è·¯å¾‘ Your Path
                </h2>
                
                <div id="instructions" class="mb-4 p-4 bg-blue-500/20 rounded">
                    <p class="font-bold">éŠæˆ²èªªæ˜ Game Instructions:</p>
                    <ol class="list-decimal list-inside text-sm space-y-1">
                        <li>é»æ“ŠğŸ¤–æŒ‰éˆ•å…ˆçœ‹AIæ¼”ç¤º | Click ğŸ¤– to watch AI demo first</li>
                        <li>é»æ“Šæ ¼å­é¸æ“‡ä½ çš„è·¯å¾‘ | Click cells to choose your path</li>
                        <li>å¾ç¶ è‰²ğŸ¢(èµ·é»)åˆ°ç´…è‰²ğŸ¯(çµ‚é») | From green ğŸ¢ to red ğŸ¯</li>
                        <li><span class="font-bold text-yellow-300">åªèƒ½ä¸Šä¸‹å·¦å³ (ä¸èƒ½æ–œèµ°!)</span></li>
                        <li>å®Œæˆå¾Œé»æ“Š"æäº¤"æ¯”è¼ƒ | Click "Submit" to compare</li>
                    </ol>
                </div>

                <div id="game-board" class="inline-block bg-white/20 p-4 rounded-lg mb-4"></div>
                
                <div class="space-y-2">
                    <button id="reset-btn" class="w-full bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-3 px-6 rounded-lg transition">
                        ğŸ”„ é‡æ–°é–‹å§‹ Reset
                    </button>
                    <button id="submit-btn" class="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-6 rounded-lg transition">
                        âœ… æäº¤è·¯å¾‘ & æ¯”è¼ƒAI | Submit & Compare with AI
                    </button>
                    <button id="undo-btn" class="w-full bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg transition">
                        â†©ï¸ æ’¤éŠ· Undo
                    </button>
                </div>

                <div id="human-stats" class="mt-4 p-4 bg-yellow-500/20 rounded-lg">
                    <p class="font-bold">ä½ çš„çµ±è¨ˆ Your Stats:</p>
                    <p>è·¯å¾‘é•·åº¦: <span id="human-length" class="text-2xl font-bold">1</span> æ­¥</p>
                    <p>ç•¶å‰ä½ç½®: <span id="human-current" class="font-mono">(0, 0)</span></p>
                </div>
            </div>

            <!-- Right: AI Results -->
            <div class="bg-white/10 p-6 rounded-lg backdrop-blur">
                <h2 class="text-2xl font-bold mb-4">
                    ğŸ¤– AI æœ€å„ªè§£ Optimal Solution
                </h2>
                
                <div id="waiting-message" class="mb-4 p-4 bg-purple-500/20 rounded-lg">
                    <p class="text-center text-lg">
                        ğŸ‘† é»æ“Šä¸Šæ–¹ğŸ¤–æŒ‰éˆ•å…ˆçœ‹AIæ¼”ç¤º<br>
                        Click ğŸ¤– button above to watch AI demo first
                    </p>
                </div>

                <div id="ai-results" class="mb-4 p-4 bg-blue-500/20 rounded-lg hidden">
                    <p class="font-bold text-green-400 text-xl">âœ… A* Complete!</p>
                    <div class="mt-2 space-y-1">
                        <p>è·¯å¾‘é•·åº¦: <span id="ai-length" class="text-2xl font-bold">-</span> æ­¥</p>
                        <p>ç¯€é»æ¢ç´¢: <span id="ai-nodes" class="text-xl font-bold">-</span> å€‹</p>
                        <p>æœ€ä½³è·¯å¾‘: <span id="ai-optimal" class="text-green-400 font-bold">Yes âœ“</span></p>
                    </div>
                </div>

                <div id="comparison" class="mb-4 p-4 bg-purple-500/20 rounded-lg hidden">
                    <p class="font-bold text-2xl mb-3">ğŸ“Š Human vs AI</p>
                    <div class="space-y-2">
                        <div class="text-center">
                            <p class="text-sm">ä½ çš„æ•ˆç‡ Your Efficiency:</p>
                            <p id="efficiency" class="text-5xl font-bold text-yellow-300">-</p>
                        </div>
                        <p>æ­¥æ•¸å·®è·: <span id="step-diff" class="text-xl font-bold">-</span></p>
                        <p id="efficiency-message" class="text-xl font-bold text-center mt-2"></p>
                    </div>
                </div>

                <div class="mb-4 p-4 bg-blue-500/20 rounded-lg">
                    <p class="font-bold mb-2">ğŸ’¡ Algorithm Insight:</p>
                    <div class="text-sm space-y-1">
                        <p>â€¢ A* ä½¿ç”¨æ›¼å“ˆé “è·é›¢ä½œç‚ºå•Ÿç™¼å¼å‡½æ•¸</p>
                        <p>â€¢ f(n) = g(n) + h(n)</p>
                        <p class="text-yellow-300">â€¢ AIä¹Ÿåªèƒ½ä¸Šä¸‹å·¦å³ç§»å‹• (å…¬å¹³ç«¶çˆ­!)</p>
                    </div>
                </div>

                <div id="console-output" class="mt-4 p-4 bg-black/50 rounded-lg font-mono text-xs overflow-auto max-h-64">
                    <p class="text-green-400 font-bold">Console Output:</p>
                    <div id="console-log"></div>
                </div>
            </div>
        </div>

        <div class="text-center mt-8">
            <a href="index.html" class="bg-gradient-to-r from-pink-500 to-purple-500 hover:from-pink-600 hover:to-purple-600 text-white font-bold py-3 px-8 rounded-full transition inline-block">
                â† è¿”å›ä¸»é¸å–® Back to Main Menu
            </a>
        </div>
    </div>

    <script>
        // ============================================================================
        // AUDIO SYSTEM
        // ============================================================================
        const clickAudio = document.getElementById('clickSound');
        const successAudio = document.getElementById('successSound');
        let bgMusicAudio = null;
        let audioInitialized = false;
        
        function initAudio() {
            if (audioInitialized) return;
            audioInitialized = true;
            
            // Create and play background music
            bgMusicAudio = new Audio('music/stage1.mp3');
            bgMusicAudio.loop = true;
            bgMusicAudio.volume = 0.2;
            bgMusicAudio.play().catch(e => {
                console.log('Background music will play on next interaction');
            });
            
            logConsole('ğŸµ Background music started!');
        }
        
        function playClick() {
            clickAudio.currentTime = 0;
            clickAudio.volume = 0.3;
            clickAudio.play().catch(e => console.log('Click sound failed'));
        }
        
        function playSuccess() {
            successAudio.currentTime = 0;
            successAudio.volume = 0.5;
            successAudio.play().catch(e => console.log('Success sound failed'));
        }

        // ============================================================================
        // GAME STATE
        // ============================================================================
        const GRID_SIZE = 8;
        let humanPath = [];
        let aiPath = [];
        let gameBoard = [];
        let pyodide = null;
        let aiDemoShown = false;

        const START = {x: 0, y: 0};
        const GOAL = {x: 7, y: 7};

        // ============================================================================
        // INITIALIZE PYODIDE
        // ============================================================================
        async function initPyodide() {
            logConsole("â³ Loading Python...");
            pyodide = await loadPyodide();
            
            await pyodide.runPythonAsync(`
import heapq
from typing import Tuple, Dict

def manhattan_distance(pos1: Tuple[int, int], pos2: Tuple[int, int]) -> int:
    return abs(pos1[0] - pos2[0]) + abs(pos1[1] - pos2[1])

def a_star_search(start: Tuple[int, int], goal: Tuple[int, int], grid_size: int = 8):
    def get_neighbors(pos):
        x, y = pos
        neighbors = []
        for dx, dy in [(0,1), (1,0), (0,-1), (-1,0)]:
            nx, ny = x + dx, y + dy
            if 0 <= nx < grid_size and 0 <= ny < grid_size:
                neighbors.append((nx, ny))
        return neighbors
    
    open_set = []
    heapq.heappush(open_set, (0, start))
    came_from = {}
    g_cost = {start: 0}
    nodes_explored = 0
    
    while open_set:
        current_f, current = heapq.heappop(open_set)
        nodes_explored += 1
        
        if current == goal:
            path = []
            while current in came_from:
                path.append(current)
                current = came_from[current]
            path.append(start)
            path.reverse()
            return {'path': path, 'length': len(path), 'nodes_explored': nodes_explored, 'optimal': True}
        
        for neighbor in get_neighbors(current):
            tentative_g = g_cost[current] + 1
            if neighbor not in g_cost or tentative_g < g_cost[neighbor]:
                came_from[neighbor] = current
                g_cost[neighbor] = tentative_g
                f_cost = tentative_g + manhattan_distance(neighbor, goal)
                heapq.heappush(open_set, (f_cost, neighbor))
    return None

def run_astar(start_x, start_y, goal_x, goal_y, grid_size=8):
    return a_star_search((start_x, start_y), (goal_x, goal_y), grid_size)
            `);
            
            logConsole("âœ… Python ready!");
        }

        // ============================================================================
        // AI DEMO
        // ============================================================================
        async function showAIDemo() {
            if (!pyodide) {
                alert('è«‹ç¨å€™ï¼ŒPythonç’°å¢ƒè¼‰å…¥ä¸­...\nPlease wait, loading Python...');
                return;
            }
            
            initAudio(); // Start music
            aiDemoShown = true;
            
            logConsole("\nğŸ¤– AI Demo - Watch & Learn!");
            logConsole("è§€çœ‹AIå¦‚ä½•æ‰¾åˆ°æœ€å„ªè·¯å¾‘...");
            
            // Reset board
            humanPath = [{x: START.x, y: START.y}];
            createBoard();
            
            // Run AI
            const result = await pyodide.runPythonAsync(`run_astar(${START.x}, ${START.y}, ${GOAL.x}, ${GOAL.y}, ${GRID_SIZE})`);
            const aiResult = result.toJs({dict_converter: Object.fromEntries});
            const demoPath = aiResult.path.map(p => ({x: p[0], y: p[1]}));
            
            // Animate AI path
            for (let i = 0; i < demoPath.length; i++) {
                await new Promise(resolve => setTimeout(resolve, 400));
                const pos = demoPath[i];
                const cell = gameBoard[pos.y][pos.x];
                
                if (i > 0 && i < demoPath.length - 1) {
                    cell.classList.add('cell-ai-path', 'ai-demo-cell');
                    cell.textContent = i;
                    playClick();
                }
                
                logConsole(`AI Step ${i}: (${pos.x}, ${pos.y})`);
            }
            
            playSuccess();
            logConsole(`\nâœ… AI Demo Complete!`);
            logConsole(`AI found optimal path: ${demoPath.length} steps`);
            logConsole(`\nğŸ‘‰ Now it's YOUR turn! Click cells to create your path!`);
            
            alert('ğŸ¤– AIæ¼”ç¤ºå®Œæˆï¼\nğŸ¤– AI Demo Complete!\n\nğŸ‘‰ ç¾åœ¨è¼ªåˆ°ä½ äº†ï¼è©¦è©¦èƒ½å¦æ‰¾åˆ°åŒæ¨£çŸ­çš„è·¯å¾‘ï¼\nğŸ‘‰ Now YOUR turn! Try to find a path as short as AI!');
            
            // Reset for human play
            setTimeout(() => {
                humanPath = [{x: START.x, y: START.y}];
                createBoard();
            }, 1000);
        }

        // ============================================================================
        // UI FUNCTIONS
        // ============================================================================
        function createBoard() {
            const board = document.getElementById('game-board');
            board.innerHTML = '';
            board.style.display = 'grid';
            board.style.gridTemplateColumns = `repeat(${GRID_SIZE}, 50px)`;
            board.style.gap = '2px';
            
            gameBoard = [];
            
            for (let y = 0; y < GRID_SIZE; y++) {
                gameBoard[y] = [];
                for (let x = 0; x < GRID_SIZE; x++) {
                    const cell = document.createElement('div');
                    cell.className = 'grid-cell';
                    cell.dataset.x = x;
                    cell.dataset.y = y;
                    
                    if (x === START.x && y === START.y) {
                        cell.classList.add('cell-start');
                        cell.textContent = 'ğŸ¢';
                        humanPath.push({x, y});
                    } else if (x === GOAL.x && y === GOAL.y) {
                        cell.classList.add('cell-goal');
                        cell.textContent = 'ğŸ¯';
                    }
                    
                    cell.addEventListener('click', () => handleCellClick(x, y));
                    board.appendChild(cell);
                    gameBoard[y][x] = cell;
                }
            }
            
            updateHumanStats();
        }

        function handleCellClick(x, y) {
            if (!aiDemoShown) {
                alert('ğŸ‘† è«‹å…ˆé»æ“Šä¸Šæ–¹ğŸ¤–æŒ‰éˆ•è§€çœ‹AIæ¼”ç¤ºï¼\nğŸ‘† Please watch AI demo first!');
                return;
            }
            
            initAudio(); // Start music on first interaction
            
            if ((x === START.x && y === START.y) || (x === GOAL.x && y === GOAL.y)) return;
            
            if (humanPath.length > 0) {
                const last = humanPath[humanPath.length - 1];
                const dx = Math.abs(x - last.x);
                const dy = Math.abs(y - last.y);
                
                if ((dx === 1 && dy === 0) || (dx === 0 && dy === 1)) {
                    playClick();
                } else {
                    alert('åªèƒ½ç§»å‹•åˆ°ç›¸é„°æ ¼å­ï¼');
                    return;
                }
            }
            
            const inPath = humanPath.some(p => p.x === x && p.y === y);
            if (inPath) {
                alert('å·²åœ¨è·¯å¾‘ä¸­ï¼');
                return;
            }
            
            humanPath.push({x, y});
            gameBoard[y][x].classList.add('cell-human-path');
            gameBoard[y][x].textContent = humanPath.length - 1;
            
            updateHumanStats();
            logConsole(`Your Step ${humanPath.length - 1}: (${x}, ${y})`);
            
            if (x === GOAL.x && y === GOAL.y) {
                playSuccess();
                gameBoard[y][x].classList.add('celebrating');
                setTimeout(() => gameBoard[y][x].classList.remove('celebrating'), 500);
                
                logConsole('ğŸ‰ You reached the goal!');
                
                setTimeout(() => {
                    if (confirm('ğŸ‰ æ­å–œåˆ°é”çµ‚é»ï¼\n\næ˜¯å¦ç«‹å³èˆ‡AIæ¯”è¼ƒï¼Ÿ\nCompare with AI now?')) {
                        runAIAndCompare();
                    }
                }, 600);
            }
        }

        function updateHumanStats() {
            document.getElementById('human-length').textContent = humanPath.length;
            if (humanPath.length > 0) {
                const last = humanPath[humanPath.length - 1];
                document.getElementById('human-current').textContent = `(${last.x}, ${last.y})`;
            }
        }

        function resetGame() {
            humanPath = [{x: START.x, y: START.y}];
            aiPath = [];
            createBoard();
            document.getElementById('ai-results').classList.add('hidden');
            document.getElementById('comparison').classList.add('hidden');
            document.getElementById('waiting-message').classList.remove('hidden');
            logConsole("ğŸ”„ Game Reset!");
        }

        function undoLastStep() {
            if (humanPath.length <= 1) {
                alert('Cannot undo start!');
                return;
            }
            
            const removed = humanPath.pop();
            const cell = gameBoard[removed.y][removed.x];
            cell.classList.remove('cell-human-path');
            cell.textContent = '';
            
            updateHumanStats();
        }

        async function runAIAndCompare() {
            if (humanPath[humanPath.length - 1].x !== GOAL.x || humanPath[humanPath.length - 1].y !== GOAL.y) {
                alert('è«‹å…ˆåˆ°é”çµ‚é»ï¼');
                return;
            }
            
            document.getElementById('waiting-message').classList.add('hidden');
            logConsole("\nğŸ¤– Running A* for comparison...");
            
            try {
                const result = await pyodide.runPythonAsync(`run_astar(${START.x}, ${START.y}, ${GOAL.x}, ${GOAL.y}, ${GRID_SIZE})`);
                const aiResult = result.toJs({dict_converter: Object.fromEntries});
                aiPath = aiResult.path.map(p => ({x: p[0], y: p[1]}));
                
                aiPath.forEach((pos, idx) => {
                    if (idx === 0 || (pos.x === GOAL.x && pos.y === GOAL.y)) return;
                    
                    const cell = gameBoard[pos.y][pos.x];
                    if (cell.classList.contains('cell-human-path')) {
                        cell.classList.add('cell-both-path');
                        cell.textContent = 'âœ“';
                    } else {
                        cell.classList.add('cell-ai-path');
                        cell.textContent = 'AI';
                    }
                });
                
                document.getElementById('ai-results').classList.remove('hidden');
                document.getElementById('ai-length').textContent = aiResult.length;
                document.getElementById('ai-nodes').textContent = aiResult.nodes_explored;
                
                const humanLength = humanPath.length;
                const aiLength = aiResult.length;
                const efficiency = Math.round((aiLength / humanLength) * 100);
                
                document.getElementById('comparison').classList.remove('hidden');
                document.getElementById('efficiency').textContent = efficiency + '%';
                document.getElementById('step-diff').textContent = `${humanLength - aiLength} steps`;
                
                let message = '';
                if (efficiency === 100) {
                    message = 'ğŸ† Perfect! Optimal!';
                    playSuccess();
                } else if (efficiency >= 90) {
                    message = 'ğŸŒŸ Excellent!';
                } else if (efficiency >= 80) {
                    message = 'ğŸ‘ Great!';
                } else {
                    message = 'ğŸ’¡ Try again?';
                }
                document.getElementById('efficiency-message').innerHTML = message;
                
                logConsole(`\nğŸ“Š Results: Your ${humanLength} | AI ${aiLength} | Efficiency ${efficiency}%`);
                
            } catch (error) {
                logConsole(`âŒ Error: ${error.message}`);
            }
        }

        function logConsole(message) {
            const log = document.getElementById('console-log');
            const p = document.createElement('p');
            p.textContent = message;
            p.className = 'mb-1';
            log.appendChild(p);
            log.scrollTop = log.scrollHeight;
        }

        // ============================================================================
        // EVENT LISTENERS
        // ============================================================================
        document.getElementById('ai-demo-btn').addEventListener('click', showAIDemo);
        document.getElementById('reset-btn').addEventListener('click', resetGame);
        document.getElementById('submit-btn').addEventListener('click', runAIAndCompare);
        document.getElementById('undo-btn').addEventListener('click', undoLastStep);

        // ============================================================================
        // INITIALIZE
        // ============================================================================
        window.addEventListener('load', async () => {
            createBoard();
            await initPyodide();
            logConsole("ğŸ‘† Click ğŸ¤– button to watch AI demo first!");
        });
    </script>
</body>
</html>